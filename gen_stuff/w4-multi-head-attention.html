<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šé ­æ³¨æ„åŠ›è¦–è¦ºåŒ–</title>
    <style>
        :root {
            --bg-color: #F4F2EF;
            --text-color: #5a5a5a;
            --accent-color: #78785b;
            --line-color: #d1d1c2;
            --highlight-color: #8c867b;
            --color-primary: rgba(120, 120, 91, 0.7);
            --color-secondary: rgba(163, 163, 128, 0.7);
            --color-accent: rgba(180, 120, 120, 0.7);
            --color-success: rgba(120, 150, 120, 0.7);
            --color-info: rgba(120, 140, 160, 0.7);
            --color-warning: rgba(160, 140, 180, 0.7);
            --color-earth: rgba(139, 125, 107, 0.7);
            --color-stone: rgba(152, 144, 136, 0.7);
            --color-moss: rgba(108, 128, 108, 0.7);
            --color-mist: rgba(168, 160, 152, 0.7);
        }

        body {
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            font-family: 'Calibri', 'Noto Sans TC', sans-serif;
            color: var(--text-color);
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--accent-color);
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .control-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .control-btn:hover {
            background: var(--highlight-color);
        }

        .control-btn.active {
            background: var(--color-accent);
        }

        .visualization {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin: 30px 0;
        }

        .input-section {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 2px solid var(--line-color);
            min-width: 400px;
        }

        .input-tokens {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .token {
            background: var(--color-primary);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            transition: transform 0.3s;
        }

        .token:hover {
            transform: scale(1.1);
        }

        .heads-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .head {
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid var(--line-color);
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
            text-align: center;
            transition: all 0.3s;
        }

        .head.active {
            border-color: var(--color-accent);
            background: rgba(180, 120, 120, 0.1);
            transform: scale(1.05);
        }

        .head-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        .head-description {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .attention-matrix {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 10px 0;
        }

        .attention-cell {
            width: 30px;
            height: 30px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            transition: all 0.3s;
        }

        .attention-cell.high {
            background: var(--color-accent);
        }

        .attention-cell.medium {
            background: var(--color-secondary);
        }

        .attention-cell.low {
            background: var(--color-mist);
        }

        .output-section {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 2px solid var(--line-color);
            min-width: 400px;
        }

        .concatenation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .head-output {
            background: var(--color-info);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .concat-arrow {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-weight: bold;
        }

        .final-output {
            background: var(--color-success);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 15px;
        }

        .explanation {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-color);
        }

        .step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            border-left: 3px solid var(--color-primary);
        }

        .step.active {
            background: rgba(120, 120, 91, 0.1);
            border-left-color: var(--color-accent);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @media (max-width: 768px) {
            .heads-container {
                flex-direction: column;
                align-items: center;
            }

            .head {
                min-width: 250px;
            }

            .input-tokens {
                gap: 5px;
            }

            .token {
                min-width: 50px;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¤šé ­æ³¨æ„åŠ›æ©Ÿåˆ¶è¦–è¦ºåŒ–</h1>

        <div class="controls">
            <button class="control-btn active" onclick="startAnimation()">é–‹å§‹å‹•ç•«</button>
            <button class="control-btn" onclick="resetAnimation()">é‡ç½®</button>
            <button class="control-btn" onclick="toggleStepMode()">é€æ­¥æ¨¡å¼</button>
        </div>

        <div class="visualization">
            <!-- è¼¸å…¥éƒ¨åˆ† -->
            <div class="input-section">
                <h3>è¼¸å…¥åºåˆ—</h3>
                <p>ç¯„ä¾‹å¥å­ï¼šã€Œæˆ‘ å–œæ­¡ åƒ è˜‹æœã€</p>
                <div class="input-tokens">
                    <div class="token" data-token="æˆ‘">æˆ‘</div>
                    <div class="token" data-token="å–œæ­¡">å–œæ­¡</div>
                    <div class="token" data-token="åƒ">åƒ</div>
                    <div class="token" data-token="è˜‹æœ">è˜‹æœ</div>
                </div>
            </div>

            <!-- å¤šå€‹æ³¨æ„åŠ›é ­ -->
            <div class="heads-container">
                <div class="head" data-head="0">
                    <div class="head-title">ğŸ‘¨â€ğŸ« å°ˆå®¶ A</div>
                    <div class="head-description">æ–‡æ³•çµæ§‹å°ˆå®¶</div>
                    <div class="attention-matrix">
                        <div class="attention-cell high" title="æˆ‘â†’æˆ‘">0.9</div>
                        <div class="attention-cell low" title="æˆ‘â†’å–œæ­¡">0.1</div>
                        <div class="attention-cell low" title="æˆ‘â†’åƒ">0.0</div>
                        <div class="attention-cell low" title="æˆ‘â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’æˆ‘">0.2</div>
                        <div class="attention-cell high" title="å–œæ­¡â†’å–œæ­¡">0.8</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’åƒ">0.0</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="åƒâ†’æˆ‘">0.1</div>
                        <div class="attention-cell medium" title="åƒâ†’å–œæ­¡">0.3</div>
                        <div class="attention-cell high" title="åƒâ†’åƒ">0.6</div>
                        <div class="attention-cell low" title="åƒâ†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’æˆ‘">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’å–œæ­¡">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’åƒ">0.2</div>
                        <div class="attention-cell high" title="è˜‹æœâ†’è˜‹æœ">0.8</div>
                    </div>
                </div>

                <div class="head" data-head="1">
                    <div class="head-title">ğŸ§  å°ˆå®¶ B</div>
                    <div class="head-description">èªæ„é—œè¯å°ˆå®¶</div>
                    <div class="attention-matrix">
                        <div class="attention-cell high" title="æˆ‘â†’æˆ‘">0.7</div>
                        <div class="attention-cell medium" title="æˆ‘â†’å–œæ­¡">0.2</div>
                        <div class="attention-cell low" title="æˆ‘â†’åƒ">0.1</div>
                        <div class="attention-cell low" title="æˆ‘â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell medium" title="å–œæ­¡â†’æˆ‘">0.4</div>
                        <div class="attention-cell high" title="å–œæ­¡â†’å–œæ­¡">0.5</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’åƒ">0.1</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="åƒâ†’æˆ‘">0.1</div>
                        <div class="attention-cell medium" title="åƒâ†’å–œæ­¡">0.3</div>
                        <div class="attention-cell high" title="åƒâ†’åƒ">0.6</div>
                        <div class="attention-cell low" title="åƒâ†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’æˆ‘">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’å–œæ­¡">0.1</div>
                        <div class="attention-cell medium" title="è˜‹æœâ†’åƒ">0.2</div>
                        <div class="attention-cell high" title="è˜‹æœâ†’è˜‹æœ">0.7</div>
                    </div>
                </div>

                <div class="head" data-head="2">
                    <div class="head-title">ğŸ”— å°ˆå®¶ C</div>
                    <div class="head-description">é‚è¼¯é †åºå°ˆå®¶</div>
                    <div class="attention-matrix">
                        <div class="attention-cell high" title="æˆ‘â†’æˆ‘">0.8</div>
                        <div class="attention-cell low" title="æˆ‘â†’å–œæ­¡">0.1</div>
                        <div class="attention-cell low" title="æˆ‘â†’åƒ">0.1</div>
                        <div class="attention-cell low" title="æˆ‘â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’æˆ‘">0.1</div>
                        <div class="attention-cell high" title="å–œæ­¡â†’å–œæ­¡">0.7</div>
                        <div class="attention-cell medium" title="å–œæ­¡â†’åƒ">0.2</div>
                        <div class="attention-cell low" title="å–œæ­¡â†’è˜‹æœ">0.0</div>
                        <div class="attention-cell low" title="åƒâ†’æˆ‘">0.0</div>
                        <div class="attention-cell low" title="åƒâ†’å–œæ­¡">0.1</div>
                        <div class="attention-cell high" title="åƒâ†’åƒ">0.6</div>
                        <div class="attention-cell medium" title="åƒâ†’è˜‹æœ">0.3</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’æˆ‘">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’å–œæ­¡">0.0</div>
                        <div class="attention-cell low" title="è˜‹æœâ†’åƒ">0.1</div>
                        <div class="attention-cell high" title="è˜‹æœâ†’è˜‹æœ">0.9</div>
                    </div>
                </div>
            </div>

            <!-- è¼¸å‡ºéƒ¨åˆ† -->
            <div class="output-section">
                <h3>ğŸ¤ ä¸‰ä½å°ˆå®¶æ•´åˆçµæœ</h3>
                <div class="concatenation">
                    <div class="head-output">ğŸ‘¨â€ğŸ« æ–‡æ³•å°ˆå®¶</div>
                    <div class="concat-arrow">âŠ•</div>
                    <div class="head-output">ğŸ§  èªæ„å°ˆå®¶</div>
                    <div class="concat-arrow">âŠ•</div>
                    <div class="head-output">ğŸ”— é‚è¼¯å°ˆå®¶</div>
                </div>
                <div class="final-output">ã€Œè˜‹æœã€= æ–‡æ³•è³“èª + èªæ„é£Ÿç‰© + é‚è¼¯å°è±¡</div>
            </div>
        </div>

        <div class="explanation">
            <h3>ã€Œå¤šä½å°ˆå®¶çœ‹æ›¸ã€çš„æ•¸å­¸è¡¨ç¤º</h3>

            <div class="step" data-step="1">
                <strong>ğŸ“š æƒ…å¢ƒï¼š</strong> å¥å­ã€Œæˆ‘ å–œæ­¡ åƒ è˜‹æœã€éœ€è¦ä¸‰ä½å°ˆå®¶åŒæ™‚åˆ†æ
            </div>

            <div class="step" data-step="2">
                <strong>ğŸ‘¨â€ğŸ« å°ˆå®¶ Aï¼ˆæ–‡æ³•çµæ§‹ï¼‰ï¼š</strong><br>
                <div style="margin-left: 1rem; font-family: monospace; background: rgba(120, 120, 91, 0.1); padding: 10px; border-radius: 5px;">
                    Q<sub>A</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>A</sub><sup>Q</sup><br>
                    K<sub>A</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>A</sub><sup>K</sup><br>
                    <strong>å°ˆæ³¨ï¼š</strong>ã€Œå–œæ­¡ã€â†’ã€Œæˆ‘ã€ï¼ˆä¸»èªé—œä¿‚ï¼‰ã€ã€Œåƒã€â†’ã€Œè˜‹æœã€ï¼ˆå‹•è³“é—œä¿‚ï¼‰
                </div>
            </div>

            <div class="step" data-step="3">
                <strong>ğŸ§  å°ˆå®¶ Bï¼ˆèªæ„é—œè¯ï¼‰ï¼š</strong><br>
                <div style="margin-left: 1rem; font-family: monospace; background: rgba(163, 163, 128, 0.1); padding: 10px; border-radius: 5px;">
                    Q<sub>B</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>B</sub><sup>Q</sup><br>
                    K<sub>B</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>B</sub><sup>K</sup><br>
                    <strong>å°ˆæ³¨ï¼š</strong>ã€Œå–œæ­¡ã€â†”ã€Œåƒã€ï¼ˆæƒ…æ„Ÿå‹•ä½œï¼‰ã€ã€Œåƒã€â†”ã€Œè˜‹æœã€ï¼ˆå‹•ä½œå°è±¡ï¼‰
                </div>
            </div>

            <div class="step" data-step="4">
                <strong>ğŸ”— å°ˆå®¶ Cï¼ˆé‚è¼¯é †åºï¼‰ï¼š</strong><br>
                <div style="margin-left: 1rem; font-family: monospace; background: rgba(180, 120, 120, 0.1); padding: 10px; border-radius: 5px;">
                    Q<sub>C</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>C</sub><sup>Q</sup><br>
                    K<sub>C</sub> = [æˆ‘, å–œæ­¡, åƒ, è˜‹æœ] Ã— W<sub>C</sub><sup>K</sup><br>
                    <strong>å°ˆæ³¨ï¼š</strong>ã€Œæˆ‘ã€â†’ã€Œå–œæ­¡ã€â†’ã€Œåƒã€â†’ã€Œè˜‹æœã€ï¼ˆæ™‚é–“é †åºï¼‰
                </div>
            </div>

            <div class="step" data-step="5">
                <strong>ğŸ¤ æ•´åˆçµæœï¼š</strong><br>
                <div style="margin-left: 1rem; font-family: monospace; background: rgba(120, 150, 120, 0.1); padding: 10px; border-radius: 5px;">
                    MultiHead = Concat(å°ˆå®¶Aè¼¸å‡º, å°ˆå®¶Bè¼¸å‡º, å°ˆå®¶Cè¼¸å‡º) Ã— W<sup>O</sup><br>
                    <strong>çµæœï¼š</strong>ã€Œè˜‹æœã€= æ–‡æ³•ä¸Šçš„è³“èª + èªæ„ä¸Šçš„é£Ÿç‰© + é‚è¼¯ä¸Šçš„å‹•ä½œå°è±¡
                </div>
            </div>
        </div>
    </div>

    <script>
        let animationInterval;
        let currentStep = 0;
        let isStepMode = false;

        function startAnimation() {
            resetAnimation();
            animateMultiHeadAttention();
        }

        function resetAnimation() {
            // æ¸…é™¤æ‰€æœ‰å‹•ç•«ç‹€æ…‹
            document.querySelectorAll('.head').forEach(head => {
                head.classList.remove('active', 'pulse');
            });
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelectorAll('.attention-cell').forEach(cell => {
                cell.classList.remove('pulse');
            });

            if (animationInterval) {
                clearInterval(animationInterval);
            }
            currentStep = 0;
        }

        function toggleStepMode() {
            isStepMode = !isStepMode;
            const btn = event.target;
            btn.classList.toggle('active');
            btn.textContent = isStepMode ? 'é€£çºŒæ¨¡å¼' : 'é€æ­¥æ¨¡å¼';
        }

        function animateMultiHeadAttention() {
            const steps = [
                () => highlightStep(1),
                () => highlightExperts(),
                () => highlightExpertAnalysis(),
                () => highlightExpertCollaboration(),
                () => highlightFinalIntegration()
            ];

            if (isStepMode) {
                // é€æ­¥æ¨¡å¼ï¼šé»æ“Šåˆ‡æ›
                document.addEventListener('click', function nextStep() {
                    if (currentStep < steps.length) {
                        steps[currentStep]();
                        currentStep++;
                    } else {
                        document.removeEventListener('click', nextStep);
                    }
                });
            } else {
                // é€£çºŒæ¨¡å¼ï¼šè‡ªå‹•æ’­æ”¾
                let stepIndex = 0;
                animationInterval = setInterval(() => {
                    if (stepIndex < steps.length) {
                        steps[stepIndex]();
                        stepIndex++;
                    } else {
                        clearInterval(animationInterval);
                        // 3ç§’å¾Œé‡æ–°é–‹å§‹
                        setTimeout(() => {
                            if (!isStepMode) {
                                animateMultiHeadAttention();
                            }
                        }, 3000);
                    }
                }, 2000);
            }
        }

        function highlightStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
        }

        function highlightExperts() {
            document.querySelectorAll('.head').forEach((head, index) => {
                setTimeout(() => {
                    head.classList.add('active', 'pulse');
                }, index * 500);
            });
            highlightStep(2);
        }

        function highlightExpertAnalysis() {
            document.querySelectorAll('.attention-cell').forEach((cell, index) => {
                setTimeout(() => {
                    cell.classList.add('pulse');
                }, index * 50);
            });
            highlightStep(3);
        }

        function highlightExpertCollaboration() {
            document.querySelectorAll('.head-output').forEach((output, index) => {
                setTimeout(() => {
                    output.classList.add('pulse');
                }, index * 300);
            });
            document.querySelectorAll('.concat-arrow').forEach((arrow, index) => {
                setTimeout(() => {
                    arrow.classList.add('pulse');
                }, index * 300 + 150);
            });
            highlightStep(4);
        }

        function highlightFinalIntegration() {
            setTimeout(() => {
                document.querySelector('.final-output').classList.add('pulse');
            }, 500);
            highlightStep(5);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ·»åŠ äº’å‹•æ•ˆæœ
            document.querySelectorAll('.token').forEach(token => {
                token.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.2)';
                    this.style.zIndex = '10';
                });
                token.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.zIndex = '1';
                });
            });

            document.querySelectorAll('.head').forEach(head => {
                head.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>
